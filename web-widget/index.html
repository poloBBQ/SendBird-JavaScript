<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <link rel='shortcut icon' href='https://s3.amazonaws.com/sendbird-static/favicon/favicon.ico' type='image/x-icon'>
  <title>Widget Sample</title>

  <style>
    body { margin: 0; background: #E9EBEE; }
  </style>

</head>
<body>

  <div style="
    position: fixed;
    top: 0;
    left: 0;
    margin: 10px;
    color: #485874;
    font-size: 14px;
    ">Ver.0.17.0</div>
  <div style="
    margin: 0 auto;
    width: 1100px;
    height: 1752px;
    background: #E9EBEE;
    "></div>

  <div id="sb_widget"></div>

</body>

<script src="SendBird.min.js"></script>
<script src="build/widget.SendBird.js"></script>
<script>
  var userId = '';
  var nickname = '';
  var appId = '';
  var apiToken = '';
  var user_ids = [];

  function post(area, body) {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "https://api.sendbird.com/v3/" + area, false);
    xhr.setRequestHeader('Content-Type', 'application/json, charset=utf8');
    xhr.setRequestHeader('Api-Token', apiToken);
    xhr.send(body);
    return JSON.parse(xhr.responseText);
  }

  function get(area, parameters) {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "https://api.sendbird.com/v3/" + area + "/" + parameters, false);
    xhr.setRequestHeader('Content-Type', 'application/json, charset=utf8');
    xhr.setRequestHeader('Api-Token', apiToken);
    xhr.send();
    return JSON.parse(xhr.responseText);
  }

  function getUserToken(userId) {
    var userInfo = get('users', "?user_ids=" + encodeURIComponent(userId));
    if(userInfo.users.length != 1) {
      // User does not exist
      userInfo = post('users', JSON.stringify({user_id: userId, nickname: nickname, profile_url: '', issue_access_token: true}));
      return userInfo.access_token;
    }
    else{
      // User already exists
      userInfo = get('users', userId);
      return userInfo.access_token;
    }
  }

  var token = getUserToken(userId);

  sbWidget.startWithConnect(appId, userId, nickname, token, function() {
    var response = post("group_channels", JSON.stringify({user_ids: user_ids, is_distinct:true}));
    sbWidget.showChannel(response.channel_url);
    sbWidget.toggleBoard(false);
  });
</script>

</html>
